//
//  main.c
//  HZLib
//
//  Created by tony on 13-11-16.
//  Copyright (c) 2013ƒÍ tony. All rights reserved.
//

#include <stdio.h>
#include <wchar.h>
#include <iconv.h>
#include <string.h>
#include "freetype.h"

//全角英文 A:0XA3C1-------Z:0XA3DA    a:0XA3E1------z:0XA3FA
//全角数字 0:A3B0
//全角符号 ：＝ A3BA

unsigned char ImgDataOri[] = {
    0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
    0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
    0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x11,0xff,0x80,0x40,0x08,0x30,0x10,0x20,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x68,0x3f,0xff,0x08,0x30,0x11,0xf8,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x68,0x3f,0xff,0x08,0x30,0x11,0xf8,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xff,0x00,0x00,0x7f,0xfe,0x7d,0x08,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x11,0x6b,0x07,0xfc,0x16,0x30,0x2d,0xf8,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0d,0xff,0x04,0x0c,0x16,0x30,0x2d,0x08,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x3f,0xff,0x16,0x30,0x2d,0xf8,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x3f,0xff,0x16,0x30,0x2d,0xf8,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0xff,0x30,0x01,0x66,0xfe,0x2d,0x26,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x00,0x03,0xf0,0x76,0x82,0x2d,0x28,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0d,0xff,0x82,0x11,0x08,0x82,0x11,0x10,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x8b,0x04,0x11,0x16,0x82,0x2d,0x28,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x8b,0x04,0x11,0x16,0x82,0x2d,0x28,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0d,0x18,0xb8,0x1f,0x60,0xfe,0x41,0xc6,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x07,0x8f,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x08,0x70,0x40,0xef,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x08,0x70,0x40,0xef,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x10,0x00,0x80,0x10,0x60,0x00,0x0f,0xff,0x30,0x0c,0x00,0x80,0x00,0x00,0x00,
    0x00,0x20,0x18,0x38,0x20,0x60,0x00,0x00,0x60,0x08,0x0c,0x1f,0xfc,0x1c,0x00,0x00,
    0x00,0xc0,0x64,0x45,0x00,0x60,0x00,0x03,0xfc,0x0b,0xff,0x00,0x80,0x3e,0x00,0x00,
    0x00,0xc1,0x00,0x01,0x00,0x10,0x00,0x00,0x80,0x00,0x0c,0x08,0x88,0x3e,0x00,0x00,
    0x00,0xc1,0x00,0x01,0x00,0x10,0x00,0x00,0x80,0x00,0x0c,0x08,0x88,0x3e,0x00,0x00,
    0x01,0x01,0x00,0x00,0xc0,0x10,0x00,0x1f,0xff,0xbd,0x8c,0x06,0xb0,0x3e,0x00,0x00,
    0x02,0x0e,0x18,0x1c,0xc0,0x10,0x00,0x01,0x00,0x04,0x4c,0x7f,0xfe,0x1c,0x00,0x00,
    0x02,0x16,0x64,0x22,0x20,0x10,0x00,0x03,0xfc,0x04,0x4c,0x01,0xc0,0x1c,0x00,0x00,
    0x02,0x16,0x64,0x22,0x20,0x10,0x00,0x03,0xfc,0x04,0x4c,0x01,0xc0,0x1c,0x00,0x00,
    0x04,0xe8,0x83,0x41,0x1c,0x08,0x00,0x0d,0x04,0x04,0x0c,0x06,0xb0,0x00,0x00,0x00,
    0x07,0x10,0x8f,0x47,0x03,0x88,0x00,0x11,0xfc,0x04,0x3c,0x08,0x88,0x1c,0x00,0x00,
    0x00,0x20,0x6c,0x26,0x01,0x78,0x00,0x01,0x04,0x0a,0x00,0x70,0x86,0x1c,0x00,0x00,
    0x00,0xc0,0x18,0x1c,0x00,0x80,0x00,0x01,0xfc,0x31,0xff,0x00,0x80,0x00,0x00,0x00,
    0x00,0xc0,0x18,0x1c,0x00,0x80,0x00,0x01,0xfc,0x31,0xff,0x00,0x80,0x00,0x00,0x00,
    0x00,0xc1,0x87,0x80,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x01,0x06,0x78,0x3c,0x20,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x01,0x08,0x07,0xc2,0xc0,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x01,0x08,0x00,0x01,0xc0,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x01,0x08,0x00,0x01,0xc0,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x01,0x08,0x18,0x01,0xc0,0x60,0x00,0x00,0x00,0xf1,0xf3,0x87,0xc0,0x00,0x00,0x00,
    0x00,0xc6,0x18,0xc2,0x20,0x80,0x00,0x00,0x03,0x0e,0x1c,0x78,0x70,0x00,0x00,0x00,
    0x00,0xc1,0x00,0xc2,0x00,0x80,0x00,0x00,0x04,0x44,0x11,0x10,0x38,0x00,0x00,0x00,
    0x00,0x26,0xe0,0x04,0x01,0x00,0x00,0x00,0x04,0x80,0x12,0x00,0x38,0x00,0x00,0x00,
    0x00,0x26,0xe0,0x04,0x01,0x00,0x00,0x00,0x04,0x80,0x12,0x00,0x38,0x00,0x00,0x00,
    0x00,0x11,0x18,0x38,0x03,0x00,0x00,0x00,0x04,0x80,0x12,0x00,0x38,0x00,0x00,0x00,
    0x00,0x0e,0x87,0xc2,0x1c,0x00,0x00,0x00,0x04,0x00,0x10,0x00,0x38,0x00,0x00,0x00,
    0x00,0x01,0xe0,0x04,0xe0,0x00,0x00,0x00,0x03,0x00,0x1c,0x00,0x70,0x00,0x00,0x00,
    0x00,0x1e,0x18,0x3f,0x1e,0x00,0x00,0x00,0x00,0x80,0x32,0x00,0xc0,0x00,0x00,0x00,
    0x00,0x1e,0x18,0x3f,0x1e,0x00,0x00,0x00,0x00,0x80,0x32,0x00,0xc0,0x00,0x00,0x00,
    0x00,0x38,0x07,0xc0,0x0f,0x00,0x00,0x00,0x00,0x40,0x61,0x01,0x80,0x00,0x00,0x00,
    0x00,0xe9,0xff,0xff,0x0d,0x80,0x00,0x00,0x00,0x31,0xc0,0x87,0x00,0x00,0x00,0x00,
    0x01,0xe9,0x1b,0xb9,0x0d,0xe0,0x00,0x00,0x00,0x0b,0x80,0x6e,0x00,0x00,0x00,0x00,
    0x03,0xc9,0xf0,0x1f,0x0c,0xf0,0x00,0x00,0x00,0x06,0x00,0x18,0x00,0x00,0x00,0x00,
    0x03,0xc9,0xf0,0x1f,0x0c,0xf0,0x00,0x00,0x00,0x06,0x00,0x18,0x00,0x00,0x00,0x00,
    0x07,0x06,0xe0,0x06,0x10,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x07,0xc1,0x00,0x00,0x20,0xf8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x07,0xe0,0x80,0x00,0xc1,0xf8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x87,0xe0,0x80,0x00,0xc1,0xf8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
    0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
    0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff   
};

unsigned char ImgData[] = {
    0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
    0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
    0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x11,0xff,0x80,0x40,0x08,0x30,0x10,0x20,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x68,0x3f,0xff,0x08,0x30,0x11,0xf8,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x68,0x3f,0xff,0x08,0x30,0x11,0xf8,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xff,0x00,0x00,0x7f,0xfe,0x7d,0x08,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x11,0x6b,0x07,0xfc,0x16,0x30,0x2d,0xf8,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0d,0xff,0x04,0x0c,0x16,0x30,0x2d,0x08,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x3f,0xff,0x16,0x30,0x2d,0xf8,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x3f,0xff,0x16,0x30,0x2d,0xf8,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0xff,0x30,0x01,0x66,0xfe,0x2d,0x26,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x00,0x03,0xf0,0x76,0x82,0x2d,0x28,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0d,0xff,0x82,0x11,0x08,0x82,0x11,0x10,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x8b,0x04,0x11,0x16,0x82,0x2d,0x28,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x8b,0x04,0x11,0x16,0x82,0x2d,0x28,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0d,0x18,0xb8,0x1f,0x60,0xfe,0x41,0xc6,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x07,0x8f,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x08,0x70,0x40,0xef,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x08,0x70,0x40,0xef,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x10,0x00,0x80,0x10,0x60,0x00,0x0f,0xff,0x30,0x0c,0x00,0x80,0x00,0x00,0x00,
    0x00,0x20,0x18,0x38,0x20,0x60,0x00,0x00,0x60,0x08,0x0c,0x1f,0xfc,0x1c,0x00,0x00,
    0x00,0xc0,0x64,0x45,0x00,0x60,0x00,0x03,0xfc,0x0b,0xff,0x00,0x80,0x3e,0x00,0x00,
    0x00,0xc1,0x00,0x01,0x00,0x10,0x00,0x00,0x80,0x00,0x0c,0x08,0x88,0x3e,0x00,0x00,
    0x00,0xc1,0x00,0x01,0x00,0x10,0x00,0x00,0x80,0x00,0x0c,0x08,0x88,0x3e,0x00,0x00,
    0x01,0x01,0x00,0x00,0xc0,0x10,0x00,0x1f,0xff,0xbd,0x8c,0x06,0xb0,0x3e,0x00,0x00,
    0x02,0x0e,0x18,0x1c,0xc0,0x10,0x00,0x01,0x00,0x04,0x4c,0x7f,0xfe,0x1c,0x00,0x00,
    0x02,0x16,0x64,0x22,0x20,0x10,0x00,0x03,0xfc,0x04,0x4c,0x01,0xc0,0x1c,0x00,0x00,
    0x02,0x16,0x64,0x22,0x20,0x10,0x00,0x03,0xfc,0x04,0x4c,0x01,0xc0,0x1c,0x00,0x00,
    0x04,0xe8,0x83,0x41,0x1c,0x08,0x00,0x0d,0x04,0x04,0x0c,0x06,0xb0,0x00,0x00,0x00,
    0x07,0x10,0x8f,0x47,0x03,0x88,0x00,0x11,0xfc,0x04,0x3c,0x08,0x88,0x1c,0x00,0x00,
    0x00,0x20,0x6c,0x26,0x01,0x78,0x00,0x01,0x04,0x0a,0x00,0x70,0x86,0x1c,0x00,0x00,
    0x00,0xc0,0x18,0x1c,0x00,0x80,0x00,0x01,0xfc,0x31,0xff,0x00,0x80,0x00,0x00,0x00,
    0x00,0xc0,0x18,0x1c,0x00,0x80,0x00,0x01,0xfc,0x31,0xff,0x00,0x80,0x00,0x00,0x00,
    0x00,0xc1,0x87,0x80,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x01,0x06,0x78,0x3c,0x20,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x01,0x08,0x07,0xc2,0xc0,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x01,0x08,0x00,0x01,0xc0,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x01,0x08,0x00,0x01,0xc0,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x01,0x08,0x18,0x01,0xc0,0x60,0x00,0x00,0x00,0xf1,0xf3,0x87,0xc0,0x00,0x00,0x00,
    0x00,0xc6,0x18,0xc2,0x20,0x80,0x00,0x00,0x03,0x0e,0x1c,0x78,0x70,0x00,0x00,0x00,
    0x00,0xc1,0x00,0xc2,0x00,0x80,0x00,0x00,0x04,0x44,0x11,0x10,0x38,0x00,0x00,0x00,
    0x00,0x26,0xe0,0x04,0x01,0x00,0x00,0x00,0x04,0x80,0x12,0x00,0x38,0x00,0x00,0x00,
    0x00,0x26,0xe0,0x04,0x01,0x00,0x00,0x00,0x04,0x80,0x12,0x00,0x38,0x00,0x00,0x00,
    0x00,0x11,0x18,0x38,0x03,0x00,0x00,0x00,0x04,0x80,0x12,0x00,0x38,0x00,0x00,0x00,
    0x00,0x0e,0x87,0xc2,0x1c,0x00,0x00,0x00,0x04,0x00,0x10,0x00,0x38,0x00,0x00,0x00,
    0x00,0x01,0xe0,0x04,0xe0,0x00,0x00,0x00,0x03,0x00,0x1c,0x00,0x70,0x00,0x00,0x00,
    0x00,0x1e,0x18,0x3f,0x1e,0x00,0x00,0x00,0x00,0x80,0x32,0x00,0xc0,0x00,0x00,0x00,
    0x00,0x1e,0x18,0x3f,0x1e,0x00,0x00,0x00,0x00,0x80,0x32,0x00,0xc0,0x00,0x00,0x00,
    0x00,0x38,0x07,0xc0,0x0f,0x00,0x00,0x00,0x00,0x40,0x61,0x01,0x80,0x00,0x00,0x00,
    0x00,0xe9,0xff,0xff,0x0d,0x80,0x00,0x00,0x00,0x31,0xc0,0x87,0x00,0x00,0x00,0x00,
    0x01,0xe9,0x1b,0xb9,0x0d,0xe0,0x00,0x00,0x00,0x0b,0x80,0x6e,0x00,0x00,0x00,0x00,
    0x03,0xc9,0xf0,0x1f,0x0c,0xf0,0x00,0x00,0x00,0x06,0x00,0x18,0x00,0x00,0x00,0x00,
    0x03,0xc9,0xf0,0x1f,0x0c,0xf0,0x00,0x00,0x00,0x06,0x00,0x18,0x00,0x00,0x00,0x00,
    0x07,0x06,0xe0,0x06,0x10,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x07,0xc1,0x00,0x00,0x20,0xf8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x07,0xe0,0x80,0x00,0xc1,0xf8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x87,0xe0,0x80,0x00,0xc1,0xf8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
    0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
    0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff
};

unsigned char sTan[] =
{0x40, 0x04, 0x2F, 0xFE, 0x20, 0xA0, 0x07, 0xFC, 0x04, 0xA4, 0xE7, 0xFC, 0x20, 0x08, 0x23, 0xFC, 0x22, 0x08, 0x23, 0xF8, 0x22, 0x08, 0x23, 0xF8, 0x28, 0x40, 0x37, 0xFE, 0x20, 0x40, 0x00, 0x40 };
unsigned char sXin[] =
{0x10, 0x08, 0x0A, 0x1C, 0x7F, 0x60, 0x00, 0x40, 0x22, 0x40, 0x14, 0x44, 0xFF, 0xFE, 0x0A, 0x48, 0x7F, 0x48, 0x08, 0x48, 0x0A, 0x48, 0x29, 0x88, 0x48, 0x88, 0x89, 0x08, 0x28, 0x08, 0x10, 0x08 };

unsigned char ConvImgData[1024];
unsigned char buffer[32];
int idx = 0;

char * ConvertEnc( char *encFrom, char *encTo, const char *in)
{
    
    static char  bufout[1024], *sin, *sout;
    size_t lenin, lenout, ret;
    iconv_t c_pt;
    
    if ((c_pt = iconv_open(encTo, encFrom)) == (iconv_t)-1)
    {
    #ifdef _DEBUG_
        printf("iconv_open false: %s ==> %s\n", encFrom, encTo);
    #endif
        return NULL;
    }
    iconv(c_pt, NULL, NULL, NULL, NULL);
    lenin  = strlen(in) + 1;
    lenout = 1024;
    sin    = (char *)in;
    sout   = bufout;
    ret = iconv(c_pt, &sin, (size_t *)&lenin, &sout, (size_t *)&lenout);
    if (ret == -1)
    {
        return NULL;
    }
    iconv_close(c_pt);
    return bufout;
    
}

int convHz(const char * word)
{
    FILE* fphzk = NULL;
    int i, j, k, offset;
    int flag;
    //unsigned char buffer[32];
    //const char * word = "谭";
    const char * gbWord="";
    unsigned char key[8] = {
        0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01
    };
    
    fphzk = fopen("/Users/tony/hzk16", "rb");
    if(fphzk == NULL){
        fprintf(stderr, "error hzk16\n");
        return 1;
    }
    gbWord = ConvertEnc("UTF-8", "GB2312", word);
    //gbWord = "\xA3\xC1"; //Ascii A code
    printf("%0X,%0X\n",gbWord[0]&0xFF,gbWord[1]&0xFF);
    offset = (94*(unsigned int)((unsigned int)(gbWord[0]&0xFF)-0xa0-1)+((unsigned int)(gbWord[1]&0xFF)-0xa0-1))*32;
    fseek(fphzk, offset, SEEK_SET);
    fread(buffer, 1, 32, fphzk);
    printf("{");
    for(k=0; k<32; k++){
        printf("0x%02X, ", buffer[k]);
    }
    printf("}\n");
    for(k=0; k<16; k++){
        for(j=0; j<2; j++){
            for(i=0; i<8; i++){
                flag = buffer[k*2+j]&key[i];
                printf("%s", flag?"*":" ");
            }
        }
        printf("\n");
    }
    fclose(fphzk);
    fphzk = NULL;
    return 0;
}


void convImage(){
    printf("Conver Image bit map begin\n");
    int i, j, b,k,n;
  //  int flag;
    unsigned char d='\0';//v='\0',t = 0;
    unsigned char buffer[8];
    unsigned char key[8] = {
        0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01
    };
    unsigned char bit[8] = {
        0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80
    };
    //8 page
    for (i=0; i<8; i++) {
        //16 byte perline
        for (j=0; j<16; j++) {
            for (b=0; b<8; b++) {
                buffer[b] = ImgData[i*16*8 + b*16 +j];
            }
            for (k=0; k<8; k++) {
                for (n = 0; n<8; n++) {
                    if(buffer[n]&key[k]) d = d|bit[n];
                  //  t = buffer[n]&key[k];
                  //  if(t != 0){
                  //      v = key[7-n];
                  //      d = d|v;
                  //  }
                }
                ConvImgData[idx++]=d;
                printf("0x%02X,",d);
                d='\0';
            }
            printf("\n");
        }
    }
}
/**
 Convert font pixal array to 128*64 LCD
 AAA         ABC
 BBB   ==>   ABC
 CCC         ABC
 */

void ConvBitmap2PageModeLCD(int pages,int cols,unsigned char *inData,int len,unsigned char *outData){
    printf("Conver power bit map begin\n");
    int i, j, b,k,n;
    //  int flag;
    unsigned char d='\0';//v='\0',t = 0;
    unsigned char buffer[8];
    unsigned char key[8] = {
        0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01
    };
    unsigned char bit[8] = {
        0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80
    };
    cols/=8;
    //8 page
    for (i=0; i<pages; i++) {
        //16 byte perline
        for (j=0; j<cols; j++) {
            for (b=0; b<8; b++) {
                buffer[b] = inData[i*cols*8 + b*cols +j];
            }
            for (k=0; k<8; k++) {
                for (n = 0; n<8; n++) {
                    if(buffer[n]&key[k]) d = d|bit[n];
                    //  t = buffer[n]&key[k];
                    //  if(t != 0){
                    //      v = key[7-n];
                    //      d = d|v;
                    //  }
                }
                if(idx < len){
                    outData[idx++]=d;
                }else{
                    outData[idx++] = 0;
                }
                printf("0x%02X,",d);
                d='\0';
            }
            printf("\n");
        }
    }
}

unsigned char outData[32];
int main(int argc, const char * argv[])
{
//    convHz("谭");
    //unsigned char c[4]="\xEF\xBC\x90\x00";
    convHz("温");
    ConvBitmap2PageModeLCD(2, 16, buffer, 2*16,outData);
    convHz("湿");
    ConvBitmap2PageModeLCD(2, 16, buffer, 2*16,outData);
    convHz("度");
    ConvBitmap2PageModeLCD(2, 16, buffer, 2*16,outData);
    /*
    convHz("声");
    ConvBitmap2PageModeLCD(2, 16, buffer, 2*16,outData);
    convHz("波");
    ConvBitmap2PageModeLCD(2, 16, buffer, 2*16,outData);
    convHz("距");
    ConvBitmap2PageModeLCD(2, 16, buffer, 2*16,outData);
    convHz("离");
    ConvBitmap2PageModeLCD(2, 16, buffer, 2*16,outData);
    convHz("探");
    ConvBitmap2PageModeLCD(2, 16, buffer, 2*16,outData);
    convHz("测");
    ConvBitmap2PageModeLCD(2, 16, buffer, 2*16,outData);
    convHz("仪");
    ConvBitmap2PageModeLCD(2, 16, buffer, 2*16,outData);
    for (int i = 0; i<11; i++) {
        convHz(c);
        c[2]+=1;
        ConvBitmap2PageModeLCD(2, 16, buffer, 2*16,outData);
    }
    */
    
    //patch img insert two hz
    int i = 0;
    int j = 0;
    int k = 0;
    for (i = 0; i <16; i++) {
        //start from row 3 + col 8
        j = (i+2) * 16 + 1;
        k = i * 2;
        ImgData[j] = sTan[k];
        ImgData[j+1] = sTan[k+1];
        ImgData[j+2] = sXin[k];
        ImgData[j+3] = sXin[k+1];
    }
    
    //convImage();
    
    ConvBitmap2PageModeLCD(2, 16, sTan, 2*16,outData);
    ConvBitmap2PageModeLCD(2, 16, sXin, 2*16,outData);
    
    char *argvs[4]={
        "freetype",
        //"/Users/tony/Documents/Dev/FreeType/wqy-microhei-lite.ttc",
        "/Users/tony/Downloads/喜满菲菲.ttf",
        "64",
        "8C2D"
    };
    
    ttfFont(4, argvs);
    
    return 0;
}



